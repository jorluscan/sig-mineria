{% extends 'base.html' %} {% load humanize %} {% block content %}
<div class="fade-in">
  <div class="mb-10">
    <h1 class="font-serif text-4xl text-zinc-900 leading-tight">
      Resumen Global
    </h1>
    <p
      class="text-zinc-600 text-[10px] uppercase tracking-[0.4em] mt-2 font-bold"
    >
      Panel de Inteligencia D'Kurvas
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
    <div class="bg-white p-6 rounded-3xl border border-zinc-200 shadow-sm">
      <span
        class="text-[9px] uppercase tracking-widest text-zinc-600 font-bold block mb-2"
        >Inversión en Stock</span
      >
      <p class="text-2xl font-serif text-zinc-900">
        ${{ total_cost|floatformat:2|intcomma }}
      </p>
      <div class="mt-2 text-[10px] text-zinc-500 italic">
        <i class="fas fa-wallet mr-2 text-gold"></i> Capital Actual
      </div>
    </div>

    <div class="bg-white p-6 rounded-3xl border border-zinc-200 shadow-sm">
      <span
        class="text-[9px] uppercase tracking-widest text-zinc-600 font-bold block mb-2"
        >Valor de Venta</span
      >
      <p class="text-2xl font-serif text-zinc-900">
        ${{ total_sales_value|floatformat:2|intcomma }}
      </p>
      <div class="mt-2 text-[10px] text-zinc-500 italic">
        <i class="fas fa-tag mr-2 text-gold"></i> Ingreso Estimado
      </div>
    </div>

    <div
      class="bg-white p-6 rounded-3xl border border-zinc-200 shadow-sm bg-zinc-900 border-none"
    >
      <span
        class="text-[9px] uppercase tracking-widest text-zinc-400 font-bold block mb-2"
        >Utilidad Bruta</span
      >
      <p class="text-2xl font-serif text-gold">
        ${{ projected_profit|floatformat:2|intcomma }}
      </p>
      <div class="mt-2 text-[10px] text-zinc-500 italic">
        <i class="fas fa-chart-line mr-2"></i> Margen Ganancia
      </div>
    </div>

    <div
      class="bg-white p-6 rounded-3xl border border-zinc-200 shadow-sm {% if low_stock_count > 0 %}border-red-200 bg-red-50/30{% endif %}"
    >
      <span
        class="text-[9px] uppercase tracking-widest text-zinc-600 font-bold block mb-2"
        >Stock Crítico</span
      >
      <p
        class="text-2xl font-serif {% if low_stock_count > 0 %}text-red-600 animate-pulse{% else %}text-zinc-900{% endif %}"
      >
        {{ low_stock_count }} <span class="text-xs font-sans">Prendas</span>
      </p>
      <div class="mt-2 text-[10px] text-zinc-500 italic">
        <i class="fas fa-exclamation-triangle mr-2"></i> Reponer Pronto
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
    <div
      class="bg-white p-8 rounded-3xl border border-zinc-200 shadow-sm flex flex-col items-center"
    >
      <h3 class="font-serif text-xl text-zinc-800 mb-6 self-start">
        Composición del Inventario
      </h3>
      <div class="w-full relative" style="height: 250px">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>

    <div
      class="lg:col-span-2 bg-white p-8 rounded-3xl border border-zinc-200 shadow-sm overflow-hidden"
    >
      <h3 class="font-serif text-xl text-zinc-800 mb-6">Últimos Movimientos</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="space-y-4">
          <p
            class="text-[10px] uppercase font-bold text-zinc-400 tracking-widest border-b border-zinc-100 pb-2"
          >
            Ingresos Recientes
          </p>
          {% for arrival in recent_arrivals %}
          <div
            class="flex justify-between items-center text-xs p-2 hover:bg-zinc-50 rounded-lg transition-colors"
          >
            <span class="font-bold text-zinc-800"
              >{{ arrival.variation.product.name }}</span
            >
            <span class="text-green-600 font-bold"
              >+{{ arrival.quantity }}</span
            >
          </div>
          {% empty %}
          <p class="text-zinc-400 text-[10px] italic">
            No hay ingresos recientes.
          </p>
          {% endfor %}
        </div>
        <div class="space-y-4">
          <p
            class="text-[10px] uppercase font-bold text-zinc-400 tracking-widest border-b border-zinc-100 pb-2"
          >
            Despachos Recientes
          </p>
          {% for dispatch in recent_dispatches %}
          <div
            class="flex justify-between items-center text-xs p-2 hover:bg-zinc-50 rounded-lg transition-colors"
          >
            <span class="font-bold text-zinc-800"
              >{{ dispatch.variation.product.name }}</span
            >
            <span class="text-amber-600 font-bold"
              >-{{ dispatch.quantity }}</span
            >
          </div>
          {% empty %}
          <p class="text-zinc-400 text-[10px] italic">
            No hay despachos registrados.
          </p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('categoryChart').getContext('2d');
  new Chart(ctx, {
      type: 'doughnut',
      data: {
          labels: {{ cat_labels|safe }},
          datasets: [{
              data: {{ cat_stocks|safe }},
              backgroundColor: ['#d4af37', '#18181b', '#71717a', '#a1a1aa'],
              borderWidth: 0
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '75%',
          plugins: { legend: { position: 'bottom', labels: { font: { size: 10, family: 'Inter' }, padding: 20 } } }
      }
  });
</script>
{% endblock %}
