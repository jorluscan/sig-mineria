{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="max-w-7xl mx-auto pb-20 animate-fade-in">
  <div class="mb-10 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
    <div>
      <a href="{% url 'inventory_list' %}"
        class="text-gold text-[10px] uppercase font-bold mb-4 inline-block hover:text-yellow-600">
        <i class="fas fa-chevron-left mr-2"></i> Volver al Catálogo
      </a>
      <h1 class="font-serif text-5xl text-zinc-900 leading-tight">{{ product.name }}</h1>
      <p class="text-zinc-500 mt-2 uppercase text-[10px] font-bold tracking-widest">
        SKU: <span class="text-zinc-800">{{ product.sku }}</span> |
        Categoría: <span class="text-zinc-800">{{ product.category.name|default:"General" }}</span>
      </p>
    </div>

    <div class="bg-white p-6 rounded-3xl border border-zinc-100 flex items-center space-x-10 shadow-sm">
      <div class="text-right">
        <span class="block text-zinc-400 text-[9px] uppercase mb-1 font-bold">Costo Base</span>
        <span class="text-xl font-serif text-zinc-400">${{ product.cost_price|floatformat:2|intcomma }}</span>
      </div>
      <div class="h-10 w-px bg-zinc-100"></div>
      <div class="text-right">
        <span class="block text-zinc-500 text-[9px] uppercase mb-1 font-bold">Precio Venta</span>
        <span class="text-3xl font-serif text-gold font-bold">${{ product.sale_price|floatformat:2|intcomma }}</span>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
    <div class="lg:col-span-2 space-y-12">
      <div class="bg-white rounded-3xl border border-zinc-100 shadow-sm overflow-hidden">
        <div class="p-8 border-b border-zinc-50 bg-zinc-50/30">
          <h3 class="font-serif text-xl text-zinc-800 italic">Disponibilidad en Boutique</h3>
        </div>

        <table class="w-full text-left">
          <thead class="bg-zinc-50/50 border-b border-zinc-100">
            <tr class="text-[10px] uppercase text-zinc-500 font-bold">
              <th class="px-8 py-5">Talla</th>
              <th class="px-8 py-5">Color</th>
              <th class="px-8 py-5 text-center">Stock</th>
              <th class="px-8 py-5">Estado</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-zinc-50">
            {% for variation in variations %}
            <tr class="hover:bg-zinc-50/30 transition-colors">
              <td class="px-8 py-5 text-sm font-bold text-zinc-900 italic">
                {{ variation.size.name|default:variation.size }}
              </td>
              <td class="px-8 py-5 text-sm text-zinc-600">
                {{ variation.color.name|default:variation.color }}
              </td>
              <td class="px-8 py-5 text-center font-serif text-lg">
                {{ variation.stock|intcomma }}
              </td>
              <td class="px-8 py-5">
                {% if variation.stock > 0 %}
                <span class="text-[9px] bg-green-50 text-green-700 px-3 py-1 rounded-full font-bold">DISPONIBLE</span>
                {% else %}
                <span class="text-[9px] bg-red-50 text-red-700 px-3 py-1 rounded-full font-bold">AGOTADO</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="p-10 text-center text-zinc-400">Sin variaciones.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="space-y-6">
      <div class="bg-zinc-900 p-8 rounded-3xl text-center border border-zinc-800 shadow-2xl">
        <p class="text-[10px] uppercase text-zinc-500 mb-8 font-bold tracking-widest italic">Acciones Rápidas</p>

        <div class="space-y-4">
          <a href="{% url 'create_stock_arrival' %}?product={{ product.id }}"
            class="block w-full bg-gold text-black py-4 rounded-2xl text-[10px] font-bold uppercase hover:bg-yellow-500 transition-all">
            <i class="fas fa-plus-circle mr-2"></i> Registrar Ingreso
          </a>

          <a href="{% url 'create_dispatch' %}?product={{ product.id }}"
            class="block w-full border border-zinc-700 text-zinc-400 py-4 rounded-2xl text-[10px] font-bold uppercase hover:text-white hover:border-white transition-all">
            <i class="fas fa-minus-circle mr-2"></i> Registrar Despacho
          </a>

          <button onclick="togglePriceForm()"
            class="block w-full border border-gold/30 text-gold py-4 rounded-2xl text-[10px] font-bold uppercase hover:bg-gold hover:text-black transition-all">
            <i class="fas fa-tag mr-2"></i> Cambiar Precio Venta
          </button>

          <div id="price-form" class="hidden mt-4 p-5 bg-zinc-800 rounded-2xl border border-zinc-700">
            <form method="POST" action="{% url 'update_product_price' product.id %}">
              {% csrf_token %}
              <input type="number" step="0.01" name="new_price" value="{{ product.sale_price }}" required
                class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white text-sm mb-4">
              <div class="flex gap-2">
                <button type="submit"
                  class="flex-1 bg-gold text-black py-2 rounded-xl text-[9px] font-bold uppercase">Guardar</button>
                <button type="button" onclick="togglePriceForm()"
                  class="flex-1 bg-zinc-700 text-zinc-300 py-2 rounded-xl text-[9px] font-bold uppercase">X</button>
              </div>
            </form>
          </div>

          <div class="pt-6 border-t border-zinc-800">
            <a href="{% url 'create_product' %}"
              class="block w-full bg-zinc-800 text-zinc-300 py-4 rounded-2xl text-[10px] font-bold uppercase hover:bg-zinc-700 hover:text-gold transition-all">
              <i class="fas fa-box-open mr-2"></i> Nuevo Producto
            </a>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-3xl border border-zinc-100 shadow-sm">
        <p class="text-[9px] uppercase text-zinc-400 font-bold mb-2">Descripción</p>
        <p class="text-sm text-zinc-600 italic">
          {% if product.description %}
          {{ product.description }}
          {% else %}
          Este producto pertenece a la colección actual de boutique sin descripción específica.
          {% endif %}
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  function togglePriceForm() {
    document.getElementById('price-form').classList.toggle('hidden');
  }
</script>
{% endblock %}